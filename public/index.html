<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InfraMap</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="brand__logo">IM</div>
          <div class="brand__text">
            <div class="brand__title">InfraMap</div>
            <div class="brand__subtitle">Infrastructure canvas</div>
          </div>
        </div>
        <div class="toolbar">
          <button class="btn btn--ghost" data-add="server">Add Server</button>
          <button class="btn btn--ghost" data-add="pc">Add PC</button>
          <button class="btn btn--ghost" data-add="router">Add Router</button>
          <button class="btn btn--ghost" data-add="switch">Add Switch</button>
          <button class="btn btn--ghost" data-add="cloud">Add Cloud</button>
          <button class="btn btn--ghost" data-add="network">Add Network</button>
          <button id="link-btn" class="btn btn--ghost">Link Mode</button>
        </div>
        <div class="toolbar toolbar--actions">
          <button id="logs-btn" class="btn btn--ghost btn--icon" type="button" title="Logs">
            <span class="btn__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="presentation">
                <path
                  d="M4 5.5A2.5 2.5 0 0 1 6.5 3h11A2.5 2.5 0 0 1 20 5.5v13a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 4 18.5v-13zm2.5-.5a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5h-11zm2.8 4.2 2.1 2.1-2.1 2.1 1.4 1.4 3.5-3.5-3.5-3.5-1.4 1.4zm5.3 5.8h4v2h-4v-2z"
                />
              </svg>
            </span>
          </button>
          <button id="undo-btn" class="btn btn--ghost btn--icon" type="button" title="Undo">
            &larr;
          </button>
          <button id="redo-btn" class="btn btn--ghost btn--icon" type="button" title="Redo">
            &rarr;
          </button>
          <div id="dirty-indicator" class="dirty-indicator is-hidden" aria-live="polite"></div>
          <button id="save-btn" class="btn btn--primary">Save JSON</button>
          <button id="reload-btn" class="btn btn--ghost">Reload</button>
        </div>
      </header>

      <main class="workspace">
        <section class="canvas-wrap">
          <div class="canvas-meta">
            <div class="chip">Drag nodes to position</div>
            <div class="chip chip--quiet">Drag background to pan</div>
            <div class="zoom-controls">
              <button id="zoom-out" class="btn btn--ghost btn--tiny" type="button">-</button>
              <div id="zoom-level" class="zoom-level">100%</div>
              <button id="zoom-in" class="btn btn--ghost btn--tiny" type="button">+</button>
              <button id="center-view" class="btn btn--ghost btn--tiny" type="button">Center</button>
            </div>
          </div>
          <div id="canvas" class="canvas" tabindex="0" aria-label="Infrastructure canvas">
            <div id="world" class="world"></div>
          </div>
        </section>
        <aside class="panel">
          <div class="panel__header">
            <div class="panel__title-row">
              <h2>Properties</h2>
              <div class="panel__actions">
                <button id="settings-btn" class="btn btn--ghost btn--icon" type="button" title="Settings">
                  <span class="btn__icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" role="presentation">
                      <path
                        d="M19.4 13.5c.04-.33.06-.67.06-1s-.02-.67-.06-1l2.02-1.57a.5.5 0 0 0 .12-.64l-1.91-3.3a.5.5 0 0 0-.6-.22l-2.38.96a7.6 7.6 0 0 0-1.73-1l-.36-2.54A.5.5 0 0 0 13.1 1h-3.2a.5.5 0 0 0-.5.42l-.36 2.54c-.62.24-1.2.56-1.73 1l-2.38-.96a.5.5 0 0 0-.6.22L2.4 7.52a.5.5 0 0 0 .12.64L4.54 9.7c-.04.33-.06.67-.06 1s.02.67.06 1l-2.02 1.57a.5.5 0 0 0-.12.64l1.91 3.3a.5.5 0 0 0 .6.22l2.38-.96c.53.44 1.11.76 1.73 1l.36 2.54a.5.5 0 0 0 .5.42h3.2a.5.5 0 0 0 .5-.42l.36-2.54c.62-.24 1.2-.56 1.73-1l2.38.96a.5.5 0 0 0 .6-.22l1.91-3.3a.5.5 0 0 0-.12-.64L19.4 13.5zM11.5 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"
                      />
                    </svg>
                  </span>
                </button>
                <button id="lock-btn" class="btn btn--ghost btn--lock btn--icon" type="button" aria-pressed="false">
                  <span class="btn__icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" role="presentation">
                      <path
                        d="M7 10V7.5C7 5.02 9.02 3 11.5 3S16 5.02 16 7.5V10h1.5c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-9c-.83 0-1.5-.67-1.5-1.5v-7C6 10.67 6.67 10 7.5 10H7zm2 0h5V7.5C14 6.12 12.88 5 11.5 5S9 6.12 9 7.5V10z"
                      />
                    </svg>
                  </span>
                  <span class="btn__label">Lock</span>
                </button>
              </div>
            </div>
            <div id="status" class="status">Ready.</div>
          </div>
          <form id="props-form" class="props">
            <label>
              Label
              <input type="text" name="label" placeholder="Server A" />
            </label>
            <label>
              Type
              <select name="type">
                <option value="server">Server</option>
                <option value="pc">PC</option>
                <option value="router">Router</option>
                <option value="switch">Switch</option>
                <option value="cloud">Cloud</option>
                <option value="network">Network</option>
              </select>
            </label>
            <div class="field-group" data-group="node">
              <label>
                Network
                <input type="text" name="network" placeholder="LAN-1 / WAN / Cloud" />
              </label>
              <label>
                Private IP
                <input type="text" name="ipPrivate" placeholder="10.0.0.10" />
              </label>
              <label>
                Tailscale IP
                <input type="text" name="ipTailscale" placeholder="100.64.0.10" />
              </label>
              <label class="toggle">
                <input type="checkbox" name="autoTailscale" />
                <span>Auto-detect Tailscale IP (SSH)</span>
              </label>
              <label>
                Public IP (Node)
                <input type="text" name="ipPublic" placeholder="203.0.113.10" />
              </label>
              <label>
                Tags
                <div class="tags-input-row">
                  <input id="tags-input" type="text" placeholder="DNS, DB" />
                  <button id="tags-add" class="btn btn--ghost btn--tiny" type="button">
                    Add
                  </button>
                </div>
              </label>
              <div id="tags-list" class="tags-list"></div>
            </div>
            <div class="field-group" data-group="network">
              <label>
                Public IP (Network)
                <input type="text" name="networkPublicIp" placeholder="203.0.113.0/24" />
              </label>
              <label>
                Color
                <input type="color" name="color" />
              </label>
              <label>
                Header position
                <div id="header-pos-grid" class="pos-grid" role="group" aria-label="Header position">
                  <button class="pos-btn" type="button" data-pos="tl" aria-label="Top left"></button>
                  <button class="pos-btn" type="button" data-pos="tc" aria-label="Top center"></button>
                  <button class="pos-btn" type="button" data-pos="tr" aria-label="Top right"></button>
                  <button class="pos-btn" type="button" data-pos="ml" aria-label="Middle left"></button>
                  <button class="pos-btn" type="button" data-pos="mc" aria-label="Middle center"></button>
                  <button class="pos-btn" type="button" data-pos="mr" aria-label="Middle right"></button>
                  <button class="pos-btn" type="button" data-pos="bl" aria-label="Bottom left"></button>
                  <button class="pos-btn" type="button" data-pos="bc" aria-label="Bottom center"></button>
                  <button class="pos-btn" type="button" data-pos="br" aria-label="Bottom right"></button>
                </div>
              </label>
              <label>
                Width
                <input type="number" name="width" min="120" step="20" />
              </label>
              <label>
                Height
                <input type="number" name="height" min="120" step="20" />
              </label>
            </div>
            <label>
              Notes
              <textarea name="notes" rows="4" placeholder="Role, OS, services"></textarea>
            </label>
            <div class="props__actions">
              <button id="layer-down" class="btn btn--ghost" type="button">Layer Down</button>
              <button id="layer-up" class="btn btn--ghost" type="button">Layer Up</button>
              <button id="delete-btn" class="btn btn--danger" type="button">Delete Node</button>
            </div>
          </form>
          <div class="panel__footer">
            <div class="hint">Data is saved to <code>data/board.json</code>.</div>
          </div>
        </aside>
      </main>
    </div>

    <div id="settings-modal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <div class="modal__backdrop" data-close="settings"></div>
      <div class="modal__panel modal__panel--scroll">
        <div class="modal__header">
          <h3 id="settings-title">Settings</h3>
          <button id="settings-close" class="btn btn--ghost btn--icon" type="button">X</button>
        </div>
        <form id="settings-form" class="settings-form">
          <label class="toggle">
            <input type="checkbox" name="pingEnabled" />
            <span>Enable ping for this device</span>
          </label>
          <label>
            Ping interval (seconds)
            <input type="number" name="pingInterval" min="5" max="3600" step="1" />
          </label>
          <label class="toggle">
            <input type="checkbox" name="showStatus" />
            <span>Show status on canvas</span>
          </label>
          <div class="divider"></div>
          <label class="toggle">
            <input type="checkbox" name="connectEnabled" />
            <span>Enable device connection (SSH)</span>
          </label>
          <label class="toggle">
            <input type="checkbox" name="isInfraMapServer" />
            <span>Mark as InfraMap server</span>
          </label>
          <label>
            OS type
            <select name="os">
              <option value="linux">Linux</option>
              <option value="windows">Windows</option>
            </select>
          </label>
          <label>
            Host / IP
            <input type="text" name="host" placeholder="192.168.0.10" />
          </label>
          <label>
            Port (optional)
            <input type="number" name="port" min="1" max="65535" placeholder="22" />
          </label>
          <label>
            Max link speed (Mbps)
            <input type="number" name="linkSpeedMbps" min="0" step="1" placeholder="1000" />
          </label>
          <label>
            Auth method
            <select name="authMethod">
              <option value="password">Username + Password</option>
              <option value="ssh_key">SSH Key</option>
            </select>
          </label>
          <label>
            Username
            <input type="text" name="username" placeholder="root" />
          </label>
          <label data-auth="password">
            Password
            <input type="password" name="password" />
          </label>
          <label data-auth="ssh_key">
            SSH private key (OpenSSH/PEM)
            <textarea name="privateKey" rows="5" placeholder="-----BEGIN OPENSSH PRIVATE KEY-----"></textarea>
          </label>
          <label data-auth="ssh_key">
            Key passphrase (optional)
            <input type="password" name="privateKeyPassphrase" />
          </label>
          <div class="settings-help" data-os="linux">
            <div class="help-title">Linux SSH setup</div>
            <div class="help-text">Install and enable SSH server: <code>sudo apt install openssh-server</code>, <code>sudo systemctl enable --now ssh</code>. Ensure port 22 is open.</div>
          </div>
          <div class="settings-help" data-os="windows">
            <div class="help-title">Windows SSH setup</div>
            <div class="help-text">Enable OpenSSH Server (PowerShell as Admin): <code>Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</code>, <code>Start-Service sshd</code>, <code>Set-Service -Name sshd -StartupType Automatic</code>. Open port 22 in firewall.</div>
          </div>
        </form>
        <div class="modal__footer">
          <button id="settings-apply" class="btn btn--primary" type="button">Apply</button>
        </div>
      </div>
    </div>

    <div id="logs-modal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="logs-title">
      <div class="modal__backdrop" data-close="logs"></div>
      <div class="modal__panel modal__panel--wide">
        <div class="modal__header">
          <h3 id="logs-title">Logs</h3>
          <button id="logs-close" class="btn btn--ghost btn--icon" type="button">X</button>
        </div>
        <div class="logs-toolbar">
          <button id="logs-refresh" class="btn btn--ghost btn--tiny" type="button">Refresh</button>
        </div>
        <pre id="logs-output" class="logs-output">Loading logs...</pre>
      </div>
    </div>

    <script src="js/state.js"></script>
    <script src="js/history.js"></script>
    <script src="js/monitoring.js"></script>
    <script src="js/canvas.js"></script>
  </body>
</html>

